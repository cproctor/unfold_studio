{% extends 'base/base.html' %}
{% load staticfiles %}

{% block head %}

    <meta charset="utf-8">
    <title>{{story.title}} | unfold.studio</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'style/inkystyle.css' %}">
    <link rel="stylesheet" href="{% static 'lib/inky/main.css' %}">
    <link rel="stylesheet" href="{% static 'lib/inky/inkTheme.css' %}">

{% endblock %}

{% block content %}
<h2>{{story.title}}</h2>
<p class="description">
{% if story.public %}
    Public story
{% else %}
    by {{story.author}} 
{% endif %}
{% if request.user.is_authenticated and request.user.profile in story.loves.all %}
    {% if story.loves.count > 1 %}
        <span class="love">&lt;3 {{story.loves.count}}</span>
    {% else %}
        <span class="love">&lt;3</span>
    {% endif %}
{% elif not request.user.is_authenticated and story.loves.count > 0 %}
    <span class="love">&lt;3 {{story.loves.count}}</span>
{% elif request.user == story.author and story.loves.count > 0 %}
    <span class="love">&lt;3 {{story.loves.count}}</span>
{% endif %}
{% if story.author == request.user or story.public %}
    [<a id="save_story" href="">Save</a>]
    [<a id="edit_story" href="{% url 'edit_story' story.id %}">Rename</a>]
    <span id="show_code_opt" style="display: none;">[<a id="show_code" href="#">Show code</a>]</span>
    <span id="hide_code_opt">[<a id="hide_code" href="#">Hide code</a>]</span>
{% else %}
    [<a id="replay_story" href="">Replay</a>]
    <span id="show_code_opt">[<a id="show_code" href="#">Show code</a>]</span>
    <span id="hide_code_opt" style="display: none;">[<a id="hide_code" href="#">Hide code</a>]</span>
{% endif %}
{% if request.user.is_authenticated %}
    {% if story.author == request.user %}
        {% if story.shared %}
            [Public. <a id="share_story" href="{% url 'unshare_story' story.id %}">Unshare?</a>]
        {% else %}
            [Private. <a id="unshare_story" href="{% url 'share_story' story.id %}">Share?</a>]
        {% endif %}
    {% else %}
        {% if request.user.profile not in story.loves.all %}
            {% if story.loves.count > 0 %}
                [<a href="{% url 'love_story' story.id %}">&lt;3 (loved by {{story.loves.count}})</a>]
            {% else %}
                [<a href="{% url 'love_story' story.id %}">&lt;3</a>]
            {% endif %}
        {% endif %}
    {% endif %}
    [<a href="{% url 'fork_story' story.id %}">Fork</a>]
{% endif %}
</p>

{# FROM INKY #}
<div id="main">
  <div class="twopane{% if not story.author == request.user and not story.public %} solo{%endif%}">
    <div id="editor"></div>
    <div class="split"></div>
    <div id="player">
      <table class="expressionWatch">
        <tbody>
        </tbody>
      </table>
      <div class="scrollContainer">
        <div class="innerText active"></div>
        <div class="hiddenBuffer">
          <div class="innerText"></div>
        </div>
      </div>
    </div>
  </div>
</div>


{# END FROM INKY #}


{# Inky imports Ace as a global, so I will follow #}
<!--<script src="{% static 'lib/ace/ace.js'%}" type="text/javascript" charset="utf-8"></script>
<script src="{% static 'lib/ace/ext-language_tools.js'%}"></script>-->

{# Main JS entry point #}
<script src="{% static 'scripts/ink.js' %}"></script>
<script>
    STORY_ID = {{story.id}};
    CSRF = "{{csrf_token}}";
    EDITABLE = {{editable}};
</script>
<script data-main="{% url 'require_entry_point' %}" src="{% static 'lib/require/require.js' %}"></script>

{% endblock %}
